============================= test session starts =============================
collecting ... collected 127 items

tests/test_api.py::TestHealthEndpoint::test_returns_200 PASSED           [  0%]
tests/test_api.py::TestHealthEndpoint::test_status_is_healthy PASSED     [  1%]
tests/test_api.py::TestHealthEndpoint::test_version_present PASSED       [  2%]
tests/test_api.py::TestHealthEndpoint::test_supported_drugs_listed PASSED [  3%]
tests/test_api.py::TestHealthEndpoint::test_supported_genes_listed PASSED [  3%]
tests/test_api.py::TestHealthEndpoint::test_timestamp_present PASSED     [  4%]
tests/test_api.py::TestMockEndpoint::test_returns_200 PASSED             [  5%]
tests/test_api.py::TestMockEndpoint::test_full_response_schema PASSED    [  6%]
tests/test_api.py::TestMockEndpoint::test_risk_assessment_fields PASSED  [  7%]
tests/test_api.py::TestMockEndpoint::test_pgx_profile_fields PASSED      [  7%]
tests/test_api.py::TestMockEndpoint::test_mock_is_high_risk_warfarin PASSED [  8%]
tests/test_api.py::TestMockEndpoint::test_explanation_has_summary PASSED [  9%]
tests/test_api.py::TestMockEndpoint::test_quality_metrics_vcf_ok PASSED  [ 10%]
tests/test_api.py::TestAnalyzeHappyPath::test_returns_200_for_warfarin PASSED [ 11%]
tests/test_api.py::TestAnalyzeHappyPath::test_all_drugs_return_200[WARFARIN] PASSED [ 11%]
tests/test_api.py::TestAnalyzeHappyPath::test_all_drugs_return_200[CODEINE] PASSED [ 12%]
tests/test_api.py::TestAnalyzeHappyPath::test_all_drugs_return_200[CLOPIDOGREL] PASSED [ 13%]
tests/test_api.py::TestAnalyzeHappyPath::test_all_drugs_return_200[SIMVASTATIN] PASSED [ 14%]
tests/test_api.py::TestAnalyzeHappyPath::test_all_drugs_return_200[AZATHIOPRINE] PASSED [ 14%]
tests/test_api.py::TestAnalyzeHappyPath::test_all_drugs_return_200[FLUOROURACIL] PASSED [ 15%]
tests/test_api.py::TestAnalyzeHappyPath::test_patient_id_echoed PASSED   [ 16%]
tests/test_api.py::TestAnalyzeHappyPath::test_drug_echoed_uppercase PASSED [ 17%]
tests/test_api.py::TestAnalyzeHappyPath::test_response_has_all_keys PASSED [ 18%]
tests/test_api.py::TestAnalyzeHappyPath::test_confidence_in_range PASSED [ 18%]
tests/test_api.py::TestAnalyzeHappyPath::test_vcf_parsing_success_true PASSED [ 19%]
tests/test_api.py::TestAnalyzeHappyPath::test_primary_gene_set PASSED    [ 20%]
tests/test_api.py::TestAnalyzeHappyPath::test_diplotype_not_empty PASSED [ 21%]
tests/test_api.py::TestAnalyzeHappyPath::test_explanation_summary_not_empty PASSED [ 22%]
tests/test_api.py::TestAnalyzeHappyPath::test_clinical_recommendation_has_dose PASSED [ 22%]
tests/test_api.py::TestAnalyzeHappyPath::test_severity_is_valid_value PASSED [ 23%]
tests/test_api.py::TestAnalyzeHappyPath::test_risk_label_is_valid_value PASSED [ 24%]
tests/test_api.py::TestAnalyzeHappyPath::test_vcfgz_extension_accepted PASSED [ 25%]
tests/test_api.py::TestAnalyzeHappyPath::test_detected_variants_is_list PASSED [ 25%]
tests/test_api.py::TestAnalyzeValidation::test_missing_patient_id_returns_error PASSED [ 26%]
tests/test_api.py::TestAnalyzeValidation::test_empty_patient_id_returns_error PASSED [ 27%]
tests/test_api.py::TestAnalyzeValidation::test_unsupported_drug_returns_400 PASSED [ 28%]
tests/test_api.py::TestAnalyzeValidation::test_missing_file_returns_422 PASSED [ 29%]
tests/test_api.py::TestAnalyzeValidation::test_wrong_file_extension_returns_400 PASSED [ 29%]
tests/test_api.py::TestAnalyzeValidation::test_empty_vcf_returns_vcf_error_or_partial PASSED [ 30%]
tests/test_api.py::TestAnalyzeValidation::test_malformed_vcf_returns_partial_response PASSED [ 31%]
tests/test_api.py::TestAnalyzeValidation::test_drug_case_insensitive PASSED [ 32%]
tests/test_api.py::TestAnalyzeValidation::test_missing_drug_returns_422 PASSED [ 33%]
tests/test_api.py::TestGeneralApi::test_unknown_route_returns_404 PASSED [ 33%]
tests/test_api.py::TestGeneralApi::test_response_content_type_json PASSED [ 34%]
tests/test_api.py::TestGeneralApi::test_docs_endpoint_available PASSED   [ 35%]
tests/test_api.py::TestGeneralApi::test_openapi_schema_available PASSED  [ 36%]
tests/test_risk_engine.py::TestInferAlleles::test_known_rsid_detected PASSED [ 37%]
tests/test_risk_engine.py::TestInferAlleles::test_unknown_rsid_ignored PASSED [ 37%]
tests/test_risk_engine.py::TestInferAlleles::test_no_rsid_ignored PASSED [ 38%]
tests/test_risk_engine.py::TestInferAlleles::test_deduplication PASSED   [ 39%]
tests/test_risk_engine.py::TestInferAlleles::test_two_distinct_alleles_detected PASSED [ 40%]
tests/test_risk_engine.py::TestInferAlleles::test_cyp2c19_gain_of_function PASSED [ 40%]
tests/test_risk_engine.py::TestInferAlleles::test_dpyd_lost_function PASSED [ 41%]
tests/test_risk_engine.py::TestAllelesToDiplotype::test_no_hits_returns_wildtype PASSED [ 42%]
tests/test_risk_engine.py::TestAllelesToDiplotype::test_one_hit_heterozygous PASSED [ 43%]
tests/test_risk_engine.py::TestAllelesToDiplotype::test_two_hits_compound PASSED [ 44%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[CYP2C9-none+none-PM] PASSED [ 44%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[CYP2C9-normal+normal-NM] PASSED [ 45%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[CYP2D6-none+none-PM] PASSED [ 46%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[CYP2D6-increased+increased-URM] PASSED [ 47%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[CYP2C19-none+none-PM] PASSED [ 48%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[CYP2C19-normal+increased-RM] PASSED [ 48%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[SLCO1B1-reduced+reduced-PM] PASSED [ 49%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[TPMT-normal+none-IM] PASSED [ 50%]
tests/test_risk_engine.py::TestLookupPhenotype::test_phenotype_lookup[DPYD-none+none-PM] PASSED [ 51%]
tests/test_risk_engine.py::TestLookupPhenotype::test_reversed_pair_key_also_works PASSED [ 51%]
tests/test_risk_engine.py::TestLookupPhenotype::test_unknown_pair_returns_default PASSED [ 52%]
tests/test_risk_engine.py::TestLookupRisk::test_high_risk_rule_exists_for_all_genes PASSED [ 53%]
tests/test_risk_engine.py::TestLookupRisk::test_confidence_score_is_valid_float PASSED [ 54%]
tests/test_risk_engine.py::TestLookupRisk::test_dose_recommendation_not_empty PASSED [ 55%]
tests/test_risk_engine.py::TestLookupRisk::test_unknown_phenotype_returns_fallback PASSED [ 55%]
tests/test_risk_engine.py::TestAssessRisk::test_warfarin_poor_metabolizer PASSED [ 56%]
tests/test_risk_engine.py::TestAssessRisk::test_warfarin_no_variants_is_low_risk PASSED [ 57%]
tests/test_risk_engine.py::TestAssessRisk::test_codeine_poor_metabolizer PASSED [ 58%]
tests/test_risk_engine.py::TestAssessRisk::test_codeine_normal_is_low_risk PASSED [ 59%]
tests/test_risk_engine.py::TestAssessRisk::test_clopidogrel_poor_metabolizer PASSED [ 59%]
tests/test_risk_engine.py::TestAssessRisk::test_simvastatin_poor_function PASSED [ 60%]
tests/test_risk_engine.py::TestAssessRisk::test_azathioprine_poor_metabolizer PASSED [ 61%]
tests/test_risk_engine.py::TestAssessRisk::test_fluorouracil_no_activity PASSED [ 62%]
tests/test_risk_engine.py::TestAssessRisk::test_output_types PASSED      [ 62%]
tests/test_risk_engine.py::TestAssessRisk::test_clinical_recommendation_keys PASSED [ 63%]
tests/test_risk_engine.py::TestAssessRisk::test_detected_variants_in_profile PASSED [ 64%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_gene_info_field_matches PASSED [ 65%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_geneinfo_field_matches PASSED [ 66%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_ann_field_matches PASSED [ 66%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_csq_field_matches PASSED [ 67%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_wrong_gene_no_match PASSED [ 68%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_case_insensitive PASSED [ 69%]
tests/test_variant_extractor.py::TestAnnotationGeneMatch::test_no_annotation_returns_false PASSED [ 70%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2C9-10-96741053-True] PASSED [ 70%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2C9-10-96698415-True] PASSED [ 71%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2C9-10-96749148-True] PASSED [ 72%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2C9-10-96698000-False] PASSED [ 73%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2C9-10-96750000-False] PASSED [ 74%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2D6-22-42522613-True] PASSED [ 74%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[SLCO1B1-12-21331549-True] PASSED [ 75%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[TPMT-6-18155418-True] PASSED [ 76%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[DPYD-1-97915614-True] PASSED [ 77%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_coordinate_matching[CYP2C9-9-96741053-False] PASSED [ 77%]
tests/test_variant_extractor.py::TestCoordinateMatch::test_chr_prefix_stripped PASSED [ 78%]
tests/test_variant_extractor.py::TestExtractVariants::test_returns_list_of_variant_info PASSED [ 79%]
tests/test_variant_extractor.py::TestExtractVariants::test_annotation_match_finds_cyp2c9 PASSED [ 80%]
tests/test_variant_extractor.py::TestExtractVariants::test_annotation_match_finds_cyp2d6 PASSED [ 81%]
tests/test_variant_extractor.py::TestExtractVariants::test_rsid_preserved PASSED [ 81%]
tests/test_variant_extractor.py::TestExtractVariants::test_chromosome_set PASSED [ 82%]
tests/test_variant_extractor.py::TestExtractVariants::test_position_set PASSED [ 83%]
tests/test_variant_extractor.py::TestExtractVariants::test_all_six_genes_find_variants PASSED [ 84%]
tests/test_variant_extractor.py::TestExtractVariants::test_unknown_gene_raises PASSED [ 85%]
tests/test_variant_extractor.py::TestExtractVariants::test_coordinate_fallback_when_no_annotations PASSED [ 85%]
tests/test_variant_extractor.py::TestExtractVariants::test_empty_variants_list_returns_empty PASSED [ 86%]
tests/test_variant_extractor.py::TestExtractVariants::test_unrelated_variants_excluded PASSED [ 87%]
tests/test_variant_extractor.py::TestExtractVariants::test_ref_and_alt_populated PASSED [ 88%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_returns_parse_result PASSED [ 88%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_success_flag_true_on_valid_vcf PASSED [ 89%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_variant_count_matches PASSED [ 90%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_variant_has_required_fields PASSED [ 91%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_rsid_extracted PASSED  [ 92%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_chrom_is_string PASSED [ 92%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_pos_is_int PASSED      [ 93%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_alt_is_list PASSED     [ 94%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_vcf_with_no_variants PASSED [ 95%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_empty_bytes_raises PASSED [ 96%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_malformed_vcf_raises PASSED [ 96%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_sample_vcf_parses_7_variants PASSED [ 97%]
tests/test_vcf_parser.py::TestParseVcfBytes::test_samples_list_populated PASSED [ 98%]
tests/test_vcf_parser.py::TestParseVcfPath::test_parses_sample_file PASSED [ 99%]
tests/test_vcf_parser.py::TestParseVcfPath::test_nonexistent_path_raises PASSED [100%]

============================ 127 passed in 15.57s =============================
